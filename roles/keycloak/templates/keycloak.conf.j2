# Keycloak Configuration File
# Generated by Ansible Keycloak Role for Trackify Project

# Database settings
db={{ keycloak_db_vendor }}
db-url-host={{ keycloak_db_host }}
db-url-port={{ keycloak_db_port }}
db-url-database={{ keycloak_db_name }}
db-username={{ keycloak_db_user }}
db-password={{ keycloak_db_password }}

# Hostname settings
hostname={{ keycloak_hostname }}
hostname-strict={{ keycloak_hostname_strict | lower }}
hostname-strict-https={{ keycloak_hostname_strict_https | lower }}

# HTTP/HTTPS settings
http-enabled=true
http-host={{ keycloak_bind_address }}
http-port={{ keycloak_port }}

{% if keycloak_ssl_enabled %}
https-port={{ keycloak_ssl_port }}
https-certificate-file={{ keycloak_ssl_keystore }}
https-certificate-key-file={{ keycloak_ssl_keystore }}
{% endif %}

# Proxy settings (for use behind Traefik)
{% if keycloak_proxy_mode is defined %}
proxy={{ keycloak_proxy_mode }}
{% endif %}
{% if keycloak_proxy_headers %}
proxy-headers=xforwarded
{% endif %}

# Cache settings (Simplified for Keycloak 23+)
cache=local

# Metrics settings
{% if keycloak_metrics_enabled %}
metrics-enabled=true
{% endif %}

# Health checks
{% if keycloak_health_enabled %}
health-enabled=true
{% endif %}

# Logging
log-level={{ keycloak_log_level }}
log-console-output=default
log-console-format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n

# Development vs Production mode
{% if inventory_hostname.startswith('dev') %}
# Development mode
{% else %}
# Production mode
{% endif %}

# Features
features=token-exchange,admin-fine-grained-authz