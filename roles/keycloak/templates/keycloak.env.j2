
# Keycloak Environment Variables
# Generated by Ansible Keycloak Role for Trackify Project

# JVM Settings
JAVA_OPTS_APPEND="{{ keycloak_jvm_opts }}"
JAVA_OPTS="-Xms{{ keycloak_jvm_heap_min }} -Xmx{{ keycloak_jvm_heap_max }} -XX:MetaspaceSize={{ keycloak_jvm_metaspace }} {{ keycloak_jvm_opts }}"

# Keycloak Admin User (for initial setup)
KEYCLOAK_ADMIN={{ keycloak_admin_user }}
KEYCLOAK_ADMIN_PASSWORD={{ keycloak_admin_password }}

# Database Configuration
KC_DB={{ keycloak_db_vendor }}
KC_DB_URL_HOST={{ keycloak_db_host }}
KC_DB_URL_PORT={{ keycloak_db_port }}
KC_DB_URL_DATABASE={{ keycloak_db_name }}
KC_DB_USERNAME={{ keycloak_db_user }}
KC_DB_PASSWORD={{ keycloak_db_password }}
KC_DB_SCHEMA={{ keycloak_db_schema }}

# Network Configuration
KC_HOSTNAME={{ keycloak_hostname }}
KC_HTTP_ENABLED=true
KC_HTTP_HOST={{ keycloak_bind_address }}
KC_HTTP_PORT={{ keycloak_port }}

{% if keycloak_ssl_enabled %}
KC_HTTPS_PORT={{ keycloak_ssl_port }}
KC_HTTPS_CERTIFICATE_FILE={{ keycloak_ssl_keystore }}
KC_HTTPS_CERTIFICATE_KEY_FILE={{ keycloak_ssl_keystore }}
{% endif %}

# Proxy Configuration
{% if keycloak_proxy_mode is defined %}
KC_PROXY={{ keycloak_proxy_mode }}
{% endif %}

# Cache Configuration (Updated for Keycloak 23+)
KC_CACHE={{ keycloak_cache_stack }}
{% if keycloak_cache_stack == "ispn" %}
KC_CACHE_CONFIG_FILE={{ keycloak_cache_config_file }}
{% endif %}

# Metrics and Health
{% if keycloak_metrics_enabled %}
KC_METRICS_ENABLED=true
{% endif %}
{% if keycloak_health_enabled %}
KC_HEALTH_ENABLED=true
{% endif %}

# Logging
KC_LOG_LEVEL={{ keycloak_log_level }}
{% if keycloak_access_log_enabled %}
KC_LOG_FILE={{ keycloak_log_dir }}/keycloak.log
{% endif %}

# Security
{% if keycloak_csrf_protection_enabled %}
KC_SPI_EVENTS_LISTENER_JBOSS_LOGGING_SUCCESS_LEVEL=info
KC_SPI_EVENTS_LISTENER_JBOSS_LOGGING_ERROR_LEVEL=warn
{% endif %}